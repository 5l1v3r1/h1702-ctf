/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void sub_880();
// __int64 __fastcall __cxa_finalize(_QWORD); weak
_BYTE *__fastcall b64_decode_ex(__int64 a1, __int64 a2, signed __int64 *a3);
// void *malloc(size_t size);
// int isalnum(int);
// void *realloc(void *ptr, size_t size);
// void *memset(void *s, int c, size_t n);
// void *memcpy(void *dest, const void *src, size_t n);
// size_t strlen(const char *s);
// char *strstr(const char *haystack, const char *needle);
// char *strcpy(char *dest, const char *src);
// void free(void *ptr);
__int64 __fastcall str_replace(char *src, const char *needle, const char *s); // idb
__int64 sub_970();
_BYTE *__fastcall b64_decode(__int64 a1, __int64 a2);
_BYTE *__fastcall b64_decode_ex(__int64 a1, __int64 a2, signed __int64 *a3);
unsigned __int64 __fastcall str_replace(char *src, const char *needle, const char *s);
unsigned __int64 __fastcall Java_com_hackerone_mobile_challenge5_PetHandler_censorCats(__int64 a1, __int64 a2, __int64 a3);
unsigned __int64 __fastcall Java_com_hackerone_mobile_challenge5_PetHandler_censorDogs(__int64 a1, __int64 a2, unsigned int a3, __int64 a4);
char *Java_com_hackerone_mobile_challenge5_PetHandler_getSomething();

//-------------------------------------------------------------------------
// Data declarations

int dword_0 = 1179403647; // weak
char aAbcdefghijklmn[68] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/dog"; // weak
void *off_3000 = &off_3000; // weak
char dest[512]; // idb


//----- (0000000000000880) ----------------------------------------------------
void sub_880()
{
  JUMPOUT(&dword_0);
}
// 0: using guessed type int dword_0;

//----- (0000000000000970) ----------------------------------------------------
__int64 sub_970()
{
  return __cxa_finalize(&off_3000);
}
// 8A0: using guessed type __int64 __fastcall __cxa_finalize(_QWORD);
// 3000: using guessed type void *off_3000;

//----- (00000000000009C0) ----------------------------------------------------
_BYTE *__fastcall b64_decode(__int64 a1, __int64 a2)
{
  return b64_decode_ex(a1, a2, 0LL);
}

//----- (00000000000009D0) ----------------------------------------------------
_BYTE *__fastcall b64_decode_ex(__int64 a1, __int64 a2, signed __int64 *a3)
{
  signed __int64 *v3; // r15
  char *v4; // rax
  unsigned __int8 v5; // bp
  unsigned __int8 v6; // r12
  unsigned __int8 v7; // r14
  unsigned __int8 v8; // r13
  signed __int64 v9; // rbx
  int v10; // edi
  unsigned int v11; // ebp
  int v12; // ebx
  int v13; // edi
  int v14; // er14
  int v15; // eax
  signed __int64 v16; // rsi
  signed __int64 v17; // rdi
  signed __int64 v18; // rsi
  bool v19; // sf
  unsigned __int8 v20; // of
  signed __int64 v21; // rdx
  signed __int64 v22; // rsi
  signed __int64 v23; // rdx
  unsigned __int8 v24; // r8
  signed __int64 v25; // rdx
  signed __int64 v26; // rsi
  signed __int64 v27; // rdx
  signed __int64 v28; // rcx
  signed __int64 v29; // rdx
  signed __int64 v30; // rcx
  signed __int64 v31; // rcx
  signed __int64 v32; // rbp
  unsigned int v33; // er14
  unsigned __int8 v34; // bl
  unsigned __int8 v35; // r8
  signed __int64 v36; // rcx
  signed __int64 v37; // rax
  signed __int64 v38; // rcx
  unsigned __int8 v39; // cl
  unsigned __int8 v40; // dl
  signed __int64 v41; // rdi
  signed __int64 v42; // rax
  signed __int64 v43; // rdi
  unsigned __int8 v44; // dl
  unsigned __int8 v45; // si
  signed __int64 v46; // rbp
  signed __int64 v47; // rax
  signed __int64 v48; // rbp
  unsigned __int8 v49; // bl
  unsigned __int8 v50; // si
  signed __int64 v51; // rbp
  signed __int64 v52; // rax
  signed __int64 v53; // rbp
  __int64 v54; // r14
  char *v55; // rbx
  _BYTE *result; // rax
  unsigned __int8 v57; // [rsp+Ch] [rbp-7Ch]
  signed __int64 v58; // [rsp+10h] [rbp-78h]
  char *ptr; // [rsp+18h] [rbp-70h]
  unsigned __int8 v60; // [rsp+20h] [rbp-68h]
  __int64 v61; // [rsp+28h] [rbp-60h]
  __int64 v62; // [rsp+30h] [rbp-58h]
  signed __int64 v63; // [rsp+40h] [rbp-48h]
  unsigned __int8 s; // [rsp+49h] [rbp-3Fh]
  unsigned __int8 v65; // [rsp+4Ah] [rbp-3Eh]
  unsigned __int8 v66; // [rsp+4Bh] [rbp-3Dh]
  unsigned __int8 v67; // [rsp+4Ch] [rbp-3Ch]
  __int16 src; // [rsp+4Dh] [rbp-3Bh]
  char v69; // [rsp+4Fh] [rbp-39h]
  unsigned __int64 v70; // [rsp+50h] [rbp-38h]

  v3 = a3;
  v62 = a1;
  v70 = __readfsqword(0x28u);
  v4 = malloc(1uLL);
  if ( !v4 )
    return 0LL;
  v5 = s;
  v6 = v65;
  v7 = v66;
  v8 = v67;
  v61 = a2;
  if ( a2 )
  {
    v9 = 0LL;
    v58 = 0LL;
    while ( 1 )
    {
      v10 = *(v62 + v9);
      if ( v10 == 61 )
      {
        v31 = v58;
        goto LABEL_64;
      }
      ptr = v4;
      v60 = *(v62 + v9);
      if ( !isalnum(v10) && (v10 | 4) != 47 )
      {
        v31 = v58;
        v4 = ptr;
        goto LABEL_64;
      }
      v11 = 1;
      if ( v61 == 1 )
        break;
      v63 = v9;
      v12 = *(v62 + v9 + 1);
      if ( v12 == 61 || !isalnum(v12) && (v12 | 4) != 47 )
        break;
      if ( v61 == 2 || (v13 = *(v62 + v63 + 2), v13 == 61) || (v57 = *(v62 + v63 + 2), !isalnum(v13)) && (v57 | 4) != 47 )
      {
        v11 = 2;
LABEL_67:
        v6 = v12;
        break;
      }
      if ( v61 == 3 || (v14 = *(v62 + v63 + 3), v14 == 61) || !isalnum(v14) && (v14 | 4) != 47 )
      {
        v11 = 3;
        v7 = v57;
        goto LABEL_67;
      }
      v15 = v14;
      v16 = 3LL;
      v5 = 0;
      v61 -= 4LL;
      while ( v60 != aAbcdefghijklmn[v16 - 3] )
      {
        if ( v60 == aAbcdefghijklmn[v16 - 2] )
        {
          v5 |= 1u;
          break;
        }
        if ( v60 == aAbcdefghijklmn[v16 - 1] )
        {
          v5 = v16 - 1;
          break;
        }
        if ( v60 == aAbcdefghijklmn[v16] )
        {
          v5 |= 3u;
          break;
        }
        v5 += 4;
        v17 = v16 + 4;
        v18 = v16 - 3;
        v20 = __OFSUB__(v18, 60LL);
        v19 = v18 - 60 < 0;
        v16 = v17;
        if ( !(v19 ^ v20) )
        {
          v5 = v60;
          break;
        }
      }
      v21 = 3LL;
      v6 = 0;
      while ( v12 != aAbcdefghijklmn[v21 - 3] )
      {
        if ( v12 == aAbcdefghijklmn[v21 - 2] )
        {
          v6 |= 1u;
          break;
        }
        if ( v12 == aAbcdefghijklmn[v21 - 1] )
        {
          v6 = v21 - 1;
          break;
        }
        if ( v12 == aAbcdefghijklmn[v21] )
        {
          v6 |= 3u;
          break;
        }
        v6 += 4;
        v22 = v21 + 4;
        v23 = v21 - 3;
        v20 = __OFSUB__(v23, 60LL);
        v19 = v23 - 60 < 0;
        v21 = v22;
        if ( !(v19 ^ v20) )
        {
          v24 = v14;
          v6 = v12;
          goto LABEL_40;
        }
      }
      v24 = v14;
LABEL_40:
      v25 = 3LL;
      v7 = 0;
      while ( v57 != aAbcdefghijklmn[v25 - 3] )
      {
        if ( v57 == aAbcdefghijklmn[v25 - 2] )
        {
          v7 |= 1u;
          break;
        }
        if ( v57 == aAbcdefghijklmn[v25 - 1] )
        {
          v7 = v25 - 1;
          break;
        }
        if ( v57 == aAbcdefghijklmn[v25] )
        {
          v7 |= 3u;
          break;
        }
        v7 += 4;
        v26 = v25 + 4;
        v27 = v25 - 3;
        v20 = __OFSUB__(v27, 60LL);
        v19 = v27 - 60 < 0;
        v25 = v26;
        if ( !(v19 ^ v20) )
        {
          v7 = v57;
          break;
        }
      }
      v28 = 3LL;
      v8 = 0;
      while ( v15 != aAbcdefghijklmn[v28 - 3] )
      {
        if ( v15 == aAbcdefghijklmn[v28 - 2] )
        {
          v8 |= 1u;
          break;
        }
        if ( v15 == aAbcdefghijklmn[v28 - 1] )
        {
          v8 = v28 - 1;
          break;
        }
        if ( v15 == aAbcdefghijklmn[v28] )
        {
          v8 |= 3u;
          break;
        }
        v8 += 4;
        v29 = v28 + 4;
        v30 = v28 - 3;
        v20 = __OFSUB__(v30, 60LL);
        v19 = v30 - 60 < 0;
        v28 = v29;
        if ( !(v19 ^ v20) )
        {
          v8 = v24;
          break;
        }
      }
      LOBYTE(src) = 4 * v5 | (v6 >> 4) & 3;
      HIBYTE(src) = 16 * v6 | (v7 >> 2) & 0xF;
      v69 = v8 + (v7 << 6);
      v4 = realloc(ptr, v58 + 3);
      if ( !v4 )
      {
        s = v5;
        v65 = v6;
        v66 = v7;
        v67 = v8;
        return 0LL;
      }
      v4[v58 + 2] = v69;
      *&v4[v58] = src;
      v9 = ((v63 << 32) + 0x400000000LL) >> 32;
      v31 = v58 + 3;
      v58 += 3LL;
      if ( !v61 )
        goto LABEL_64;
    }
    s = v60;
    v65 = v6;
    v66 = v7;
    v67 = v8;
    v33 = v11;
    v34 = 0;
    memset(&s + v11, 0, 4 - v11);
    v35 = s;
    v36 = 3LL;
    while ( s != aAbcdefghijklmn[v36 - 3] )
    {
      if ( s == aAbcdefghijklmn[v36 - 2] )
      {
        v34 |= 1u;
        break;
      }
      if ( s == aAbcdefghijklmn[v36 - 1] )
      {
        v34 = v36 - 1;
        break;
      }
      if ( s == aAbcdefghijklmn[v36] )
      {
        v34 |= 3u;
        break;
      }
      v34 += 4;
      v37 = v36 + 4;
      v38 = v36 - 3;
      v20 = __OFSUB__(v38, 60LL);
      v19 = v38 - 60 < 0;
      v36 = v37;
      if ( !(v19 ^ v20) )
        goto LABEL_79;
    }
    s = v34;
    v35 = v34;
LABEL_79:
    v39 = v65;
    v40 = 0;
    v41 = 3LL;
    while ( v65 != aAbcdefghijklmn[v41 - 3] )
    {
      if ( v65 == aAbcdefghijklmn[v41 - 2] )
      {
        v40 |= 1u;
        break;
      }
      if ( v65 == aAbcdefghijklmn[v41 - 1] )
      {
        v40 = v41 - 1;
        break;
      }
      if ( v65 == aAbcdefghijklmn[v41] )
      {
        v40 |= 3u;
        break;
      }
      v40 += 4;
      v42 = v41 + 4;
      v43 = v41 - 3;
      v20 = __OFSUB__(v43, 60LL);
      v19 = v43 - 60 < 0;
      v41 = v42;
      if ( !(v19 ^ v20) )
        goto LABEL_90;
    }
    v65 = v40;
    v39 = v40;
LABEL_90:
    v44 = v66;
    v45 = 0;
    v46 = 3LL;
    while ( v66 != aAbcdefghijklmn[v46 - 3] )
    {
      if ( v66 == aAbcdefghijklmn[v46 - 2] )
      {
        v45 |= 1u;
        break;
      }
      if ( v66 == aAbcdefghijklmn[v46 - 1] )
      {
        v45 = v46 - 1;
        break;
      }
      if ( v66 == aAbcdefghijklmn[v46] )
      {
        v45 |= 3u;
        break;
      }
      v45 += 4;
      v47 = v46 + 4;
      v48 = v46 - 3;
      v20 = __OFSUB__(v48, 60LL);
      v19 = v48 - 60 < 0;
      v46 = v47;
      if ( !(v19 ^ v20) )
        goto LABEL_101;
    }
    v66 = v45;
    v44 = v45;
LABEL_101:
    v49 = v67;
    v50 = 0;
    v51 = 3LL;
    while ( v67 != aAbcdefghijklmn[v51 - 3] )
    {
      if ( v67 == aAbcdefghijklmn[v51 - 2] )
      {
        v50 |= 1u;
        break;
      }
      if ( v67 == aAbcdefghijklmn[v51 - 1] )
      {
        v50 = v51 - 1;
        break;
      }
      if ( v67 == aAbcdefghijklmn[v51] )
      {
        v50 |= 3u;
        break;
      }
      v50 += 4;
      v52 = v51 + 4;
      v53 = v51 - 3;
      v20 = __OFSUB__(v53, 60LL);
      v19 = v53 - 60 < 0;
      v51 = v52;
      if ( !(v19 ^ v20) )
        goto LABEL_112;
    }
    v67 = v50;
    v49 = v50;
LABEL_112:
    v32 = v58;
    LOBYTE(src) = 4 * v35 | (v39 >> 4) & 3;
    HIBYTE(src) = 16 * v39 | (v44 >> 2) & 0xF;
    v69 = v49 + (v44 << 6);
    v4 = realloc(ptr, v58 + v33 - 1);
    if ( !v4 )
      return 0LL;
    if ( v33 >= 2 )
    {
      v54 = v33 - 2;
      v55 = v4;
      memcpy(&v4[v58], &src, v54 + 1);
      v4 = v55;
      v32 = v58 + v54 + 1;
    }
  }
  else
  {
    v31 = 0LL;
LABEL_64:
    s = v5;
    v65 = v6;
    v66 = v7;
    v67 = v8;
    v32 = v31;
  }
  result = realloc(v4, v32 + 1);
  if ( !result )
    return 0LL;
  result[v32] = 0;
  if ( v3 )
    *v3 = v32;
  return result;
}

//----- (00000000000010B0) ----------------------------------------------------
unsigned __int64 __fastcall str_replace(char *src, const char *needle, const char *s)
{
  const char *v3; // rbp
  char *v4; // r15
  char *v5; // rbx
  size_t v6; // rbp
  char *v7; // r14
  char *v8; // r12
  char *v9; // rbx
  size_t v11; // [rsp+10h] [rbp-448h]
  const char *v12; // [rsp+18h] [rbp-440h]
  char sa; // [rsp+20h] [rbp-438h]
  unsigned __int64 v14; // [rsp+420h] [rbp-38h]

  v3 = s;
  v4 = src;
  v14 = __readfsqword(0x28u);
  v5 = &sa;
  memset(&sa, 0, 0x400uLL);
  v11 = strlen(needle);
  v12 = v3;
  v6 = strlen(v3);
  v7 = strstr(src, needle);
  if ( v7 )
  {
    v8 = &sa;
    v4 = src;
    do
    {
      memcpy(v8, v4, v7 - v4);
      v9 = &v8[v7 - v4];
      memcpy(v9, v12, v6);
      v5 = &v9[v6];
      v4 = &v7[v11];
      v7 = strstr(&v7[v11], needle);
      v8 = v5;
    }
    while ( v7 );
  }
  strcpy(v5, v4);
  strcpy(src, &sa);
  return __readfsqword(0x28u);
}

//----- (00000000000011D0) ----------------------------------------------------
unsigned __int64 __fastcall Java_com_hackerone_mobile_challenge5_PetHandler_censorCats(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // rbx
  const void *v4; // rax
  __int64 v5; // r14
  unsigned __int64 result; // rax
  __int64 v7; // [rsp+0h] [rbp-228h]
  unsigned __int64 v8; // [rsp+208h] [rbp-20h]

  v3 = a1;
  v8 = __readfsqword(0x28u);
  v4 = (*(*a1 + 1472LL))(a1, a3, 0LL);
  memcpy(&v7, v4, 0x230uLL);
  v5 = (*(*v3 + 1408LL))(v3, 512LL);
  (*(*v3 + 1664LL))(v3, v5, 0LL, 512LL, &v7);
  result = __readfsqword(0x28u);
  if ( result == v8 )
    result = v5;
  return result;
}

//----- (0000000000001270) ----------------------------------------------------
unsigned __int64 __fastcall Java_com_hackerone_mobile_challenge5_PetHandler_censorDogs(__int64 a1, __int64 a2, unsigned int a3, __int64 a4)
{
  unsigned int v4; // er14
  const char *v5; // rax
  __int64 v6; // rbp
  __int64 v7; // rax
  char *v8; // rbp
  __int64 v9; // rbp
  unsigned __int64 result; // rax
  __int64 v11; // [rsp+0h] [rbp-428h]
  char dest; // [rsp+200h] [rbp-228h]
  unsigned __int64 v13; // [rsp+400h] [rbp-28h]

  v4 = a3;
  v13 = __readfsqword(0x28u);
  v5 = (*(*a1 + 1352LL))(a1, a4, 0LL);
  v6 = v5;
  v7 = strlen(v5);
  v8 = b64_decode_ex(v6, v7, 0LL);
  if ( strlen(v8) < 0x201 )
  {
    strcpy(&dest, v8);
    strcpy(::dest, v8);
    str_replace(&dest, "dog", "xxx");
    free(v8);
    v9 = (*(*a1 + 0x580LL))(a1, v4);
    (*(*a1 + 0x680LL))(a1, v9, 0LL, v4, &v11);
  }
  else
  {
    free(v8);
    v9 = 0LL;
  }
  result = __readfsqword(0x28u);
  if ( result == v13 )
    result = v9;
  return result;
}

//----- (0000000000001370) ----------------------------------------------------
char *Java_com_hackerone_mobile_challenge5_PetHandler_getSomething()
{
  return dest;
}

// ALL OK, 8 function(s) have been successfully decompiled